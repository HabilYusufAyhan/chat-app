<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./style.css" />
    <title>Chat app</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"
        integrity="sha512-zoJXRvW2gC8Z0Xo3lBbao5+AS3g6YWr5ztKqaicua11xHo+AvE1b0lT9ODgrHTmNUxeCw0Ry4BGRYZfXu70weg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="/css/chat.css">
</head>

<body>
    <div class="mainfriendpage">
        <div class="friendpage">
            <input placeholder="Arkadaşınızın Emaili" type="text">
            <div class="friend">
                <p class="friendname">Lorem, ipsum dolor.</p>
                <p class="friendemail">asdasdasd@gmail.com</p>
                <button class="friendrequest">Arkadaşlık İsteği Gönder</button>
            </div>
        </div>
    </div>
    <div class="app">

        <div class="sidebar">
            <div class="mainheader">
                <header class="header">
                    <div class="header-img">
                        <img src="/uploads/avatars/<%- user.avatar %>" />
                    </div>
                    <div class="owner">
                        <h4><%-user.ad %> <%- user.soyad %></h4>
                    </div>
                    <div class="settings">
                        <i class="dropdown fa-solid fa-list-ul"></i>
                        <div class="dropdownmenu">
                            <ul class="dropdownul">
                                <li class="dropdownli"><a href="">Arkadaş Ekle</a></li>
                                <li class="dropdownli"><a href="">Profilim</a></li>
                                <li class="dropdownli"><a href="">Şifre Değiştir</a></li>
                                <li class="dropdownli"><a style="color: red;" href="">Çıkış Yap</a></li>
                            </ul>
                        </div>
                    </div>
                </header>
                <div class="searchbar">
                    <input type="search" placeholder="Ara..." /><button>Ara</button>
                </div>
            </div>
            <% alluser.forEach(element=> { %>
                <a href="/chat?id=<%- element._id %>">
                    <div class="user">
                        <div class="image">
                            <img src="/uploads/avatars/<%- element.avatar %>" />
                        </div>
                        <div class="description">
                            <h3><%- element.ad %> <%- element.soyad %></h3>

                            <% if (element.socketid !=null) { %>
                                <span class="online">Online</span>
                                <% } %>
                                    <% if (element.socketid==null) { %>
                                        <span class="offline">Offline</span>
                                        <% } %>

                        </div>
                    </div>
                </a>
                <% }) %>


        </div>
        <div class="chat">
            <% if (receiver) { %>
                <header>
                    <img class="profileimg" src="/uploads/avatars/<%- receiver.avatar %>" />
                    <h2><%- receiver.ad %> <%- receiver.soyad %></h2>
                    <div class="settings">
                        <i class="userdropdown fa-solid fa-list-ul"></i>
                        <div class="dropdownmenu2">
                            <ul class="dropdownul">
                                <li class="dropdownli"><a href="/profile?id=<%- receiver._id %>">Profiline Git</a></li>
                                <li class="dropdownli"><a style="color: red;" href="">Arkadaşlıktan Çıkar</a></li>
                            </ul>
                        </div>
                    </div>
                </header>

                <section>
                    <div class="chat-box">
                        <% message.forEach(element=> { %>
                            <% if (user.id===element.gonderen) { %>
                                <div class="message sent">
                                    <div class="message-content">
                                        <%- element.mesaj %>
                                    </div>
                                </div>
                                <% } else { %>
                                    <div class="message received">
                                        <div class="message-content">
                                            <%- element.mesaj %>
                                        </div>
                                    </div>
                                    <% } %>

                                        <% }) %>

                    </div>
                    <div class="yazma">
                        <span style="color: white; opacity: 0; margin-left: 20px;" class="writing">Yazıyor...</span>
                    </div>
                </section>

                <div class="input-container">
                    <input type="text" class="mesaj" id="message-input" placeholder="Mesajınızı girin" />
                    <button class="gonder">Gönder</button>
                </div>
                <% } %>
        </div>
    </div>
    <script src="/js/chat.js">
        const button = document.querySelector('.gonder');



        button.onclick = function () {
            const scrollableDiv = document.querySelector('.chat-box');
            scrollableDiv.scrollTop = scrollableDiv.scrollHeight;
        }
    </script>
    <script>

    </script>

</body>

</html>